# =============================================================================
# 配置文件: config_hfe_dilation_only.yaml
# 描述: HFE模块内消融 - 仅膨胀率差异（无专门化增强）
# 对应论文表格: Tab. ablation_hfe
# =============================================================================

experiment:
  id: "ablation_hfe_dilation_only"
  description: "HFE内消融: 仅膨胀率差异(d=1,2,4)"
  seed: 42

data:
  path: "data/hopt3d"
  train_split: "train"
  val_split: "val"
  test_split: "test"

network:
  backbone: "MinkUNet14A"
  in_channels: 3
  out_channels: 256
  tanh: True
  embeddings_only: False
  skip: "full"
  
  # HFE - 仅膨胀率差异，无专门化增强
  hfe:
    enabled: True
    mode: "dilation_only"        # 特殊模式：仅膨胀率差异
    global_branch:
      dilation: 4                # 大膨胀率
      use_global_pool: False     # ✗ 禁用全局池化
      channel_reduction: null    # ✗ 禁用通道重标定
    semantic_branch:
      dilations: [2]             # 中等膨胀率（单尺度）
      use_multiscale: False      # ✗ 禁用多尺度融合
    local_branch:
      dilation: 1                # 小膨胀率
      use_edge_enhance: False    # ✗ 禁用边界增强
  
  cdag:
    enabled: False

tasks:
  semantic_segmentation:
    enabled: True
    n_classes: 6
    ignore_idx: 0
    stuff_ids: [1, 2, 5]
    things_ids: [3, 4]
  instance_segmentation:
    enabled: True
    variance: 0.01
    fg_classes: [3, 4]
  tree_segmentation:
    enabled: True
    variance: 0.5

loss:
  semantic:
    type: "cross_entropy"
    weight: 1.0
  instance:
    type: "lovasz"
    weight: 1.0
  tree:
    type: "lovasz"
    weight: 1.0
  hcl:
    enabled: False
    weight: 0.0

train:
  max_epoch: 500
  lr: 0.005
  weight_decay: 0.01
  batch_size: 1
  n_gpus: 1
  workers: 4
  voxel_resolution: 0.003
  overfit: False
  scheduler:
    type: "cosine"
    warmup_epochs: 10
    min_lr: 1.0e-6
  optimizer:
    type: "adamw"
    betas: [0.9, 0.999]
  early_stopping:
    enabled: True
    monitor: "Metrics_pqs/mpq"
    patience: 50
    warmup: 100

transform:
  enabled: True
  scale:
    min_factor: 0.8
    max_factor: 1.2
  rotation:
    max_x: 15
    max_y: 15
    max_z: 180
  shear:
    max_factor: 0.2
  downsample:
    min_ratio: 0.6
    max_ratio: 1.0
  color:
    contrast: [0.8, 1.2]
    brightness: 0.2
    hue: 0.15
    saturation: 0.15

val:
  min_n_points_fruit: 60
  min_n_points_trunk: 250
  min_n_points_tree: 1000
  pq_from_epoch: 50

clustering:
  algorithm: "hdbscan"
  hdbscan:
    min_cluster_size: 50
    min_samples: 10
